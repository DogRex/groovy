<?xml version="1.0"?>
<project name="jsr" default="default">
  <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
  <!--                   directories                     -->
  <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
  <property name="publish.dir" value="/home/projects/groovy/public_html/jsr"/>
  <property name="spec.wiki.dir" value="spec/wiki"/>

  <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
  <!--                  targets                          -->
  <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
  <target name="default" 
          depends="publish" 
          description="default: publish distributables"
  />
  
  <target name="clean" description="remove all built files">
    <!--workaround for biscuit local dir issue -->
    <delete file="SearchAndReplace"/>
    <delete file="SearchAndReplaceRegex"/>
    <delete file="TemplatePage.html"/>

    <ant dir="spec" target="clean"/> 
    <ant dir="tck" target="clean"/> 
    <ant dir="ideas/parsers/antlr" target="clean"/>
  </target>

  <target name="compile">
    <echo>
--------------------
create the parser...
--------------------
    </echo>
    <ant dir="ideas/parsers/antlr" target="standalone" inheritAll="false"/>

    <!-- place parser in tck -->
    <copy todir="tck/testlib">
      <fileset dir="ideas/parsers/antlr/standalone"/>
    </copy>
  </target>


  <target name="test" depends="compile">
    <echo>
--------------------------------------
execute the tck over the new parser...
--------------------------------------
    </echo>
    <ant dir="tck" target="pretty-test" inheritAll="false"/>
  </target>


  <target name="doc">
    <echo>
-----------------------
render specification...
-----------------------
    </echo>
    <!--workaround for biscuit local dir issue -->
    <copy file="spec/SearchAndReplace" todir="."/>
    <copy file="spec/SearchAndReplaceRegex" todir="."/>
    <copy file="spec/TemplatePage.html" todir="."/>
    <ant dir="spec" target="render" inheritAll="false"/>
  </target>

  <target name="dist" depends="test,doc" description="create distributables"/>

  <target name="publish" depends="dist" description="publish distributables">
    <copy todir="${publish.dir}/spec">
      <fileset dir="${spec.wiki.dir}"/>
    </copy>

    <ant dir="ideas/parsers/antlr" target="docs" inheritAll="false"/>
    <copy todir="${publish.dir}/spec">
      <fileset dir="ideas/parsers/antlr/doc/">
        <include name="GroovyRecognizer.html"/>
        <include name="GroovyLexer.html"/>
      </fileset>
    </copy>

    <copy todir="${publish.dir}/tck">
      <fileset dir="tck/reports"/>
    </copy>
  </target>

</project>
